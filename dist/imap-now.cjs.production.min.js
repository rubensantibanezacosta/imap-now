"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r,e=(r=require("imap"))&&"object"==typeof r&&"default"in r?r.default:r,n=require("mailparser");function t(r){var e,n,t,i=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,t=Symbol.iterator);i--;){if(n&&null!=(e=r[n]))return e.call(r);if(t&&null!=(e=r[t]))return new o(e.call(r));n="@@asyncIterator",t="@@iterator"}throw new TypeError("Object is not async iterable")}function o(r){function e(r){if(Object(r)!==r)return Promise.reject(new TypeError(r+" is not an object."));var e=r.done;return Promise.resolve(r.value).then((function(r){return{value:r,done:e}}))}return(o=function(r){this.s=r,this.n=r.next}).prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(r){var n=this.s.return;return void 0===n?Promise.resolve({value:r,done:!0}):e(n.apply(this.s,arguments))},throw:function(r){var n=this.s.return;return void 0===n?Promise.reject(r):e(n.apply(this.s,arguments))}},new o(r)}function i(){i=function(){return e};var r,e={},n=Object.prototype,t=n.hasOwnProperty,o=Object.defineProperty||function(r,e,n){r[e]=n.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function f(r,e,n){return Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),r[e]}try{f({},"")}catch(r){f=function(r,e,n){return r[e]=n}}function l(r,e,n,t){var i=Object.create((e&&e.prototype instanceof y?e:y).prototype),a=new S(t||[]);return o(i,"_invoke",{value:B(r,n,a)}),i}function h(r,e,n){try{return{type:"normal",arg:r.call(e,n)}}catch(r){return{type:"throw",arg:r}}}e.wrap=l;var p="suspendedStart",m="executing",v="completed",d={};function y(){}function g(){}function w(){}var x={};f(x,c,(function(){return this}));var b=Object.getPrototypeOf,E=b&&b(b(F([])));E&&E!==n&&t.call(E,c)&&(x=E);var P=w.prototype=y.prototype=Object.create(x);function L(r){["next","throw","return"].forEach((function(e){f(r,e,(function(r){return this._invoke(e,r)}))}))}function j(r,e){function n(o,i,a,c){var s=h(r[o],r,i);if("throw"!==s.type){var u=s.arg,f=u.value;return f&&"object"==typeof f&&t.call(f,"__await")?e.resolve(f.__await).then((function(r){n("next",r,a,c)}),(function(r){n("throw",r,a,c)})):e.resolve(f).then((function(r){u.value=r,a(u)}),(function(r){return n("throw",r,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(r,t){function o(){return new e((function(e,o){n(r,t,e,o)}))}return i=i?i.then(o,o):o()}})}function B(e,n,t){var o=p;return function(i,a){if(o===m)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:r,done:!0}}for(t.method=i,t.arg=a;;){var c=t.delegate;if(c){var s=O(c,t);if(s){if(s===d)continue;return s}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if(o===p)throw o=v,t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);o=m;var u=h(e,n,t);if("normal"===u.type){if(o=t.done?v:"suspendedYield",u.arg===d)continue;return{value:u.arg,done:t.done}}"throw"===u.type&&(o=v,t.method="throw",t.arg=u.arg)}}}function O(e,n){var t=n.method,o=e.iterator[t];if(o===r)return n.delegate=null,"throw"===t&&e.iterator.return&&(n.method="return",n.arg=r,O(e,n),"throw"===n.method)||"return"!==t&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+t+"' method")),d;var i=h(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,d;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=r),n.delegate=null,d):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,d)}function k(r){var e={tryLoc:r[0]};1 in r&&(e.catchLoc=r[1]),2 in r&&(e.finallyLoc=r[2],e.afterLoc=r[3]),this.tryEntries.push(e)}function _(r){var e=r.completion||{};e.type="normal",delete e.arg,r.completion=e}function S(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(k,this),this.reset(!0)}function F(e){if(e||""===e){var n=e[c];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(t.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=r,n.done=!0,n};return i.next=i}}throw new TypeError(typeof e+" is not iterable")}return g.prototype=w,o(P,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=f(w,u,"GeneratorFunction"),e.isGeneratorFunction=function(r){var e="function"==typeof r&&r.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,w):(r.__proto__=w,f(r,u,"GeneratorFunction")),r.prototype=Object.create(P),r},e.awrap=function(r){return{__await:r}},L(j.prototype),f(j.prototype,s,(function(){return this})),e.AsyncIterator=j,e.async=function(r,n,t,o,i){void 0===i&&(i=Promise);var a=new j(l(r,n,t,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(r){return r.done?r.value:a.next()}))},L(P),f(P,u,"Generator"),f(P,c,(function(){return this})),f(P,"toString",(function(){return"[object Generator]"})),e.keys=function(r){var e=Object(r),n=[];for(var t in e)n.push(t);return n.reverse(),function r(){for(;n.length;){var t=n.pop();if(t in e)return r.value=t,r.done=!1,r}return r.done=!0,r}},e.values=F,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(_),!e)for(var n in this)"t"===n.charAt(0)&&t.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=r)},stop:function(){this.done=!0;var r=this.tryEntries[0].completion;if("throw"===r.type)throw r.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(t,o){return c.type="throw",c.arg=e,n.next=t,o&&(n.method="next",n.arg=r),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=t.call(a,"catchLoc"),u=t.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(r,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&t.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===r||"continue"===r)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=r,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(r,e){if("throw"===r.type)throw r.arg;return"break"===r.type||"continue"===r.type?this.next=r.arg:"return"===r.type?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):"normal"===r.type&&e&&(this.next=e),d},finish:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===r)return this.complete(n.completion,n.afterLoc),_(n),d}},catch:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===r){var t=n.completion;if("throw"===t.type){var o=t.arg;_(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,t){return this.delegate={iterator:F(e),resultName:n,nextLoc:t},"next"===this.method&&(this.arg=r),d}},e}function a(r,e,n,t,o,i,a){try{var c=r[i](a),s=c.value}catch(r){return void n(r)}c.done?e(s):Promise.resolve(s).then(t,o)}function c(r){return function(){var e=this,n=arguments;return new Promise((function(t,o){var i=r.apply(e,n);function c(r){a(i,t,o,c,s,"next",r)}function s(r){a(i,t,o,c,s,"throw",r)}c(void 0)}))}}exports.ImapNow=function(){function r(r){this.imap=new e(r)}var o=r.prototype;return o.connect=function(){var r=this;return new Promise((function(e,n){r.imap.once("ready",(function(){console.log("Connected to IMAP server"),e()})),r.imap.once("error",(function(r){console.error("Error connecting to IMAP server"),console.error(r),n(r)})),r.imap.once("end",(function(){console.log("Connection to IMAP server ended")})),r.imap.connect()}))},o.end=function(){var r=this;return new Promise((function(e,n){try{r.imap.end(),e()}catch(r){n(r)}}))},o.destroy=function(){var r=this;return new Promise((function(e,n){try{r.imap.destroy(),e()}catch(r){n(r)}}))},o.openBox=function(r){var e=this;return new Promise((function(n,t){e.imap.openBox(r,!1,(function(e,o){e?(console.error("Error opening mailbox "+r),console.error(e),t(e)):n(o)}))}))},o.closeBox=function(r){var e=this;return new Promise((function(n,t){e.imap.closeBox(!0,(function(e){e?(console.error("Error closing mailbox "+r),console.error(e),t(e)):n()}))}))},o.getBoxes=function(){var r=this;return new Promise((function(e,n){r.imap.getBoxes("",(function(r,t){r?(console.error("Error getting mailboxes"),console.error(r),n(r)):e(t)}))}))},o.addBox=function(r){var e=this;return new Promise((function(n,t){e.imap.addBox(r,(function(e){e?(console.error("Error adding mailbox "+r),console.error(e),t(e)):n()}))}))},o.deleteBox=function(r){var e=this;return new Promise((function(n,t){e.imap.delBox(r,(function(e){e?(console.error("Error deleting mailbox "+r),console.error(e),t(e)):n()}))}))},o.renameBox=function(r,e){var n=this;return new Promise((function(t,o){n.imap.renameBox(r,e,(function(n){n?(console.error("Error renaming mailbox "+r+" to "+e),console.error(n),o(n)):t()}))}))},o.subscribeBox=function(r){var e=this;return new Promise((function(n,t){e.imap.subscribeBox(r,(function(e){e?(console.error("Error subscribing to mailbox "+r),console.error(e),t(e)):n()}))}))},o.unsubscribeBox=function(r){var e=this;return new Promise((function(n,t){e.imap.unsubscribeBox(r,(function(e){e?(console.error("Error unsubscribing from mailbox "+r),console.error(e),t(e)):n()}))}))},o.boxStatus=function(r){var e=this;return new Promise((function(n,t){e.imap.status(r,(function(e,o){e?(console.error("Error getting status for mailbox "+r),console.error(e),t(e)):n(o)}))}))},o.getSubscribedBoxes=function(){var r=this;return new Promise((function(e,n){r.imap.getSubscribedBoxes("",(function(r,t){r?(console.error("Error getting subscribed mailboxes"),console.error(r),n(r)):e(t)}))}))},o.addMailListener=function(r){this.imap.on("mail",r)},o.removeMailListener=function(r){this.imap.removeListener("mail",r)},o.addUpdateListener=function(r){this.imap.on("update",r)},o.addExpungeListener=function(r){this.imap.on("expunge",r)},o.removeExpungeListener=function(r){this.imap.removeListener("expunge",r)},o.addCloseListener=function(r){this.imap.on("close",r)},o.search=function(){var r=c(i().mark((function r(e){var n=this;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise((function(r,t){n.imap.search(e,(function(e,n){e?(console.error("Error searching for messages"),console.error(e),t(e)):r(n)}))})));case 1:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),o.fetchOne=function(r,e){var t=this;return new Promise((function(o,i){var a=t.imap.fetch([r],e),c=[];a.on("message",(function(r,e){var t={parsedMail:void 0,seen:!0,flags:[]};r.on("body",(function(e,s){var u=[];e.on("data",(function(r){u.push(r)})),e.once("end",(function(){var e=Buffer.concat(u).toString("utf8");n.simpleParser(e,(function(r,e){r?i(r):t.parsedMail=e})),r.on("attributes",(function(r){t.seen=r.flags.includes("\\Seen"),t.flags=r.flags}))})),r.once("end",(function(){setTimeout((function(){t.parsedMail&&t.parsedMail.date&&(c.push(t),1==c.length&&o(c))}),1e3)})),a.once("error",(function(r){console.error("Error fetching message"),console.error(r),i(r)}))}))}))}))},o.fetch=function(){var r=c(i().mark((function r(e,n){var o,a,c,s,u,f,l;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:o=[],a=!1,c=!1,r.prev=3,u=t(e);case 5:return r.next=7,u.next();case 7:if(!(a=!(f=r.sent).done)){r.next=16;break}return l=f.value,r.next=11,this.fetchOne(l,n);case 11:o.push.apply(o,r.sent);case 13:a=!1,r.next=5;break;case 16:r.next=22;break;case 18:r.prev=18,r.t0=r.catch(3),c=!0,s=r.t0;case 22:if(r.prev=22,r.prev=23,!a||null==u.return){r.next=27;break}return r.next=27,u.return();case 27:if(r.prev=27,!c){r.next=30;break}throw s;case 30:return r.finish(27);case 31:return r.finish(22);case 32:return r.abrupt("return",o);case 33:case"end":return r.stop()}}),r,this,[[3,18,22,32],[23,,27,31]])})));return function(e,n){return r.apply(this,arguments)}}(),o.copy=function(r,e){var n=this;return new Promise((function(t,o){n.imap.copy(r,e,(function(r){r?(console.error("Error copying message"),console.error(r),o(r)):t()}))}))},o.move=function(r,e){var n=this;return new Promise((function(t,o){n.imap.move(r,e,(function(r){r?(console.error("Error moving message"),console.error(r),o(r)):t()}))}))},o.addFlags=function(r,e){var n=this;return new Promise((function(t,o){n.imap.addFlags(r,e,(function(r){r?(console.error("Error adding flags"),console.error(r),o(r)):t()}))}))},o.delFlags=function(r,e){var n=this;return new Promise((function(t,o){n.imap.delFlags(r,e,(function(r){r?(console.error("Error removing flags"),console.error(r),o(r)):t()}))}))},o.setFlags=function(r,e){var n=this;return new Promise((function(t,o){n.imap.setFlags(r,e,(function(r){r?(console.error("Error setting flags"),console.error(r),o(r)):t()}))}))},o.addKeywords=function(r,e){var n=this;return new Promise((function(t,o){n.imap.addKeywords(r,e,(function(r){r?(console.error("Error adding keywords"),console.error(r),o(r)):t()}))}))},o.delKeywords=function(r,e){var n=this;return new Promise((function(t,o){n.imap.delKeywords(r,e,(function(r){r?(console.error("Error removing keywords"),console.error(r),o(r)):t()}))}))},o.setKeywords=function(r,e){var n=this;return new Promise((function(t,o){n.imap.setKeywords(r,e,(function(r){r?(console.error("Error setting keywords"),console.error(r),o(r)):t()}))}))},o.serverSupports=function(r){return this.imap.serverSupports(r)},o.expunge=function(r){var e=this;return new Promise((function(n,t){e.imap.expunge(r,(function(r){r?(console.error("Error expunging messages"),console.error(r),t(r)):n()}))}))},o.append=function(r,e){var n=this;return new Promise((function(t,o){n.imap.append(r,e,(function(r){r?(console.error("Error appending message"),console.error(r),o(r)):t()}))}))},r}();
//# sourceMappingURL=imap-now.cjs.production.min.js.map
